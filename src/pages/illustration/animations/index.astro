---
import BaseLayout from '@layouts/BaseLayout.astro';
import Animation from '@components/animation.astro';
import { getCollection } from 'astro:content';
import { cn } from '@lib/utils';
import GridLayout from '@components/GridLayout.astro';
import PageTitle from '@components/PageTitle.astro';
import LinkButton from '@components/LinkButton.astro';

const animations = await getCollection('animations');

// generate structured data for video gallery
const canonicalUrl = new URL('/illustration/animations/', Astro.site);

const videoStructuredData = {
  '@context': 'https://schema.org',
  '@type': 'ItemList',
  name: 'Animations',
  description: 'Some of my favorite animations',
  url: canonicalUrl.toString(),
  itemListElement: animations.map((animation, index) => ({
    '@type': 'ListItem',
    position: index + 1,
    item: {
      '@type': 'VideoObject',
      name: animation.data.title,
      thumbnailUrl: `https://img.youtube.com/vi/${animation.data.embedId}/maxresdefault.jpg`,
      embedUrl: `https://www.youtube.com/embed/${animation.data.embedId}`,
      contentUrl: `https://www.youtube.com/watch?v=${animation.data.embedId}`,
      ...(animation.data.date && { uploadDate: animation.data.date.toISOString() }),
    },
  })),
};
---

<BaseLayout title={'Animations'} description={'Some of my favorite animations'}>
  <script
    is:inline
    type="application/ld+json"
    set:html={JSON.stringify(videoStructuredData, null, 0)}
  />
  <div class="flex justify-between items-center mb-8">
    <PageTitle title="Animations" />
    <LinkButton href="/illustration/">‚Üê Back to Illustrations</LinkButton>
  </div>
  <section>
    <GridLayout maxColumns={3}>
      {
        animations.map((animation) => (
          <div class="flex flex-col gap-4">
            <Animation embedId={animation.data.embedId} />
            <h3 class={cn('mt-3 mb-1 text-2xl leading-1.1')}>{animation.data.title}</h3>
          </div>
        ))
      }
    </GridLayout>
  </section>
</BaseLayout>

<style>
  iframe.instagram-media {
    max-width: 100% !important;
    width: 100% !important;
    min-width: auto !important;
  }
</style>
