---
import PageTitle from '@components/PageTitle.astro';
import BaseLayout from '@layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import Animation from '@components/animation.astro';

export async function getStaticPaths() {
  const animations = await getCollection('animations');
  return animations.map((animation, index) => ({
    params: { slug: animation.data.slug },
    props: { animation, next: animations[index + 1], prev: animations[index - 1] },
  }));
}

const { animation, next, prev } = Astro.props;

// canonical URL for this watch page (signals to Google that the video is the main content)
const canonicalUrl = new URL(`/illustration/animations/${animation.data.slug}/`, Astro.site);

const videoStructuredData = {
  '@context': 'https://schema.org',
  '@type': 'VideoObject',
  name: animation.data.title,
  description: animation.data.description,
  thumbnailUrl: `https://img.youtube.com/vi/${animation.data.embedId}/maxresdefault.jpg`,
  embedUrl: `https://www.youtube.com/embed/${animation.data.embedId}`,
  contentUrl: `https://www.youtube.com/watch?v=${animation.data.embedId}`,
  mainEntityOfPage: {
    '@type': 'WebPage',
    '@id': canonicalUrl.toString(),
  },
  ...(animation.data.date && { uploadDate: animation.data.date.toISOString() }),
};
---

<BaseLayout title={animation?.data.title} description={animation?.data?.description}>
  <script
    is:inline
    type="application/ld+json"
    set:html={JSON.stringify(videoStructuredData, null, 0)}
  />
  <PageTitle title={animation?.data.title} />

  <main class="flex flex-col gap-4 py-4">
    <Animation embedId={animation.data.embedId} title={animation.data.title} watchMode />
  </main>

  <wa-divider></wa-divider>

  <nav class="flex justify-between p-3 gap-8 text-accent" aria-label="Animation navigation">
    {
      prev?.data?.slug ? (
        <a
          href={`/illustration/animations/${prev?.data?.slug}/`}
          class="flex gap-2 items-center transition-color duration-200 hover:text-brand-200"
        >
          <span>{`< `}</span> {prev?.data?.title}
        </a>
      ) : (
        <div />
      )
    }
    {
      next?.data?.slug && (
        <a
          href={`/illustration/animations/${next?.data?.slug}/`}
          class="flex gap-2 items-center transition-color duration-200 hover:text-brand-200"
        >
          {next?.data?.title} <span>{` >`}</span>
        </a>
      )
    }
  </nav>
  <a
    href="/illustration/animations/"
    class="prose dark:prose-invert text-decoration-underline text-prose-link text-right"
    >Back to animations</a
  >
</BaseLayout>
