---
import BaseLayout from '@layouts/BaseLayout.astro';
import Image from '@components/Image.astro';
import PostCard from '@components/PostCard.astro';
import ProjectGrid from '@components/ProjectGrid.astro';
import { getCollection } from 'astro:content';
import { SITE_TITLE } from '../consts';
import LinkButton from '@components/LinkButton.astro';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const featuredPost = allPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())[0];
---

<BaseLayout title={SITE_TITLE}>
  <div class="flex flex-col gap-9 md:gap-20">
    <section>
      <div class="flex gap-8 pt-12 md:pt-24 items-center flex-col md:flex-row">
        <div class="order-0 md:order-1 w-[200px] h-[200px] shrink-0">
          <Image
            src="joel-turner_nobg"
            alt="Joel Turner"
            class="rounded-full w-[200px] h-[200px] mx-auto block bg-white dark:bg-black shadow-xl"
            width={200}
            height={200}
            gravity="faces"
            loading="eager"
            fetchpriority="high"
          />
        </div>

        <div class="prose prose-lg dark:prose-invert flex-1">
          <h1 class="flex justify-center md:justify-start text-3xl md:text-4xl gap-2">
            Howdy! I'm Joel
            <div class="animation-keyframes w-8 h-8 inline-flex items-center justify-center">
              <wa-animation easing="ease-in-out" duration="2000" play>
                <div class="box">üëãüèª</div>
              </wa-animation>
            </div>
          </h1>

          <p>
            Hi there! I'm a <strong>web developer & digital adventurer</strong> with a background in graphic
            design and web development. By day, I'm a Senior Product Engineer at <LinkButton
              href="https://copilotcrm.com">Copilot CRM</LinkButton
            >, but in my free time I love to let my artistic side shine by practicing <LinkButton
              href="/illustration/">hand lettering and sketching</LinkButton
            >. When I'm not busy creating, you can find me exploring the great outdoors in Portland
            with my awesome family (including our furry canine companions)!
          </p>
        </div>
      </div>
    </section>

    <div class="flex flex-col gap-4">
      <h2 class="text-2xl font-bold">Latest Blog Post</h2>
      {featuredPost && <PostCard post={featuredPost} featured />}
    </div>

    <div class="flex flex-col gap-4">
      <h2 class="text-2xl font-bold">Projects I'm Working On</h2>
      <ProjectGrid />
    </div>
  </div>
</BaseLayout>

<script>
  // optimize animation initialization to avoid blocking main thread
  (function () {
    interface WAAnimation extends HTMLElement {
      keyframes: Array<{
        offset: number;
        easing: string;
        fillMode: string;
        transformOrigin: string;
        transform: string;
      }>;
    }

    function initAnimation() {
      const animation = document.querySelector('.animation-keyframes wa-animation') as WAAnimation;
      if (animation) {
        // ensure animation uses composited properties (transform)
        animation.keyframes = [
          {
            offset: 0,
            easing: 'ease-in-out',
            fillMode: 'both',
            transformOrigin: 'center center',
            transform: 'rotate(0deg)',
          },
          {
            offset: 0.1,
            easing: 'ease-in-out',
            fillMode: 'both',
            transformOrigin: 'center center',
            transform: 'rotate(-10deg)',
          },
          {
            offset: 0.5,
            easing: 'ease-in-out',
            fillMode: 'both',
            transformOrigin: 'center center',
            transform: 'rotate(45deg)',
          },
          {
            offset: 1,
            easing: 'ease-in-out',
            fillMode: 'both',
            transformOrigin: 'center center',
            transform: 'rotate(0deg)',
          },
        ];
      }
    }

    // defer initialization to avoid blocking initial render
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initAnimation);
    } else {
      setTimeout(initAnimation, 0);
    }
  })();
</script>
